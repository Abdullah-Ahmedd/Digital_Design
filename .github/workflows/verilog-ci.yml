name: Verilog CI

on: [push, pull_request]

jobs:
  compile-verilog:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Install Icarus Verilog
      run: sudo apt-get install -y iverilog

    - name: Compile all Verilog testbenches
      run: |
        echo "ğŸ” Searching for testbenches..."

        # Find all testbenches (files ending with _tb.v)
        TB_FILES=$(find . -type f -name "*_tb.v")

        if [ -z "$TB_FILES" ]; then
          echo "âŒ No testbenches found. Make sure files end with _tb.v"
          exit 1
        fi

        # Find all .v files (design + testbenches)
        ALL_V=$(find . -type f -name "*.v")

        echo "ğŸ§ª Found testbenches:"
        echo "$TB_FILES"

        # Compile each testbench with all .v files
        for tb in $TB_FILES; do
          echo "ğŸš€ Compiling testbench: $tb"
          iverilog -g2012 -Wall -o sim_out $ALL_V
        done

        echo "âœ… All testbenches compiled successfully."
