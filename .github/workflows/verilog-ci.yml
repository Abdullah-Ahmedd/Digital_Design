name: Verilog Full Build CI

on: [push, pull_request]

jobs:
  build-verilog:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3

    - name: Install Icarus Verilog
      run: sudo apt-get install -y iverilog

    - name: Find and Compile All Verilog Testbenches
      run: |
        echo "ğŸ” Searching for testbenches..."
        TB_FILES=$(find . -type f -name '*_tb.v')

        if [ -z "$TB_FILES" ]; then
          echo "âŒ No testbenches found. Please name testbenches as *_tb.v"
          exit 1
        fi

        echo "ğŸ§ª Found testbenches:"
        echo "$TB_FILES"

        echo "ğŸ”§ Compiling each testbench with full source tree..."
        for tb in $TB_FILES; do
          echo "ğŸš€ Compiling $tb"
          iverilog -g2012 -Wall -o sim_out "$tb" $(find . -type f -name '*.v' ! -name '*_tb.v')
        done

        echo "âœ… Syntax check complete."
